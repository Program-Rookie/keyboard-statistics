好的，这是一份基于我们之前讨论的“按键统计桌面程序”的需求文档 (Requirements Document)。

    ---

按键统计桌面程序 - 需求文档

版本: 1.0日期: 2023年10月27日

1. 引言 (Introduction)

* 1.1 目的 (Purpose):

本文档旨在详细定义“按键统计桌面程序”的功能性及非功能性需求。该程序旨在帮助用户了解个人键盘使用习惯、频率和模式，以辅助提高生产力、关注打字健康，并为自我量化提供数据支持。本文档将作为项目开发、测试和未来迭代的基础。本项目初期倾向于开源，并优先考虑用户隐私。

* 1.2 项目范围 (Scope):
* 包含功能:
* 后台全局键盘事件监听（仅记录按键发生，不记录具体内容）。
* 按键次数统计（总量、分类别）。
* 按键频率 (KPM) 计算与展示。
* 常用按键及组合键识别。
* 按键活动时间分布可视化。
* 将按键活动关联到前台应用程序。
* 数据图表化展示。
* 用户数据本地存储。
* 用户数据导出功能。
* 用户对数据记录的启停控制及数据删除。
* 基于用户输入和简单规则的基础健康风险评估提示。
* 引导用户导出数据并在外部网站进行 AI 分析的功能入口。
* 排除功能 (v1.0):
* 记录具体的按键字符内容 (Keylogging)。
* 鼠标点击、移动或滚轮统计。
* 任何形式的网络数据传输（核心功能部分）、云同步或在线备份。
* 内置 AI 分析功能。
* 移动平台（iOS, Android）版本。
* 多用户账户系统。
* 直接的盈利功能（如内置广告、付费墙）。
* 1.3 定义、缩写和术语 (Definitions, Acronyms, and Abbreviations):
* KPM:

 Keys Per Minute (每分钟按键次数)。

* GUI:

 Graphical User Interface (图形用户界面)。

* OS:

 Operating System (操作系统)。

* API:

 Application Programming Interface (应用程序编程接口)。

* Native Module/FFI:

 指用于与操作系统底层功能交互的代码模块 (如 C++, Rust, Swift/Objective-C)。

* Local Storage:

 数据存储在用户本地计算机硬盘上。

* OSS:

 Open Source Software (开源软件)。

* RSI:

 Repetitive Strain Injury (重复性劳损)。

* PoC:

 Proof of Concept (概念验证)。

* 1.4 参考资料 (References):
* 本项目相关的商业可行性分析报告。
* 关于技术选型（Electron, Tauri 等）的讨论记录。
* 1.5 文档概述 (Document Overview):

本文档后续章节将描述产品总体概览、具体的功能性需求、非功能性需求、界面需求以及潜在的未来考虑。

2. 整体描述 (Overall Description)

* 2.1 产品愿景 (Product Perspective):

该产品是一个独立的、运行于用户本地计算机的桌面应用程序。它作为个人工具，通过后台静默记录键盘活动（非内容）并提供数据分析，帮助用户洞察自身习惯。产品强调隐私保护，核心数据处理完全在本地进行。计划以开源形式发布，鼓励透明度和社区参与，并作为开发者积累用户和展示技术的平台。

* 2.2 主要产品功能 (Product Features):
* 键盘活动监控:

 在后台捕获全局键盘事件。

* 数据统计与分析:

 计算总数、频率、常用键、时间分布、应用关联。

* 数据可视化:

 以图表形式直观展示统计结果。

* 用户控制与隐私:

 提供数据管理权限，确保数据本地化。

* 基础健康评估:

 基于用户输入提供简单的风险提示。

* 数据导出:

 允许用户将数据用于其他目的（包括外部 AI 分析）。

* 2.3 用户特征 (User Classes and Characteristics):
* 生产力追求者:

 程序员、作家、编辑、数据录入员等希望量化工作、优化效率的用户。

* 健康关注者:

 关心长时间键盘使用可能导致的 RSI 等健康问题的用户。

* 自我量化爱好者:

 喜欢追踪和分析个人行为数据的用户。

* 游戏玩家:

 对操作频率 (APM/KPM) 和常用键位感兴趣的玩家。

* (潜在) 开源社区参与者:

 对项目技术或理念感兴趣的开发者。

* 2.4 操作环境 (Operating Environment):
* 操作系统:

 Windows 10 及以上版本 (x64), macOS (具体版本待定，如 10.15 Catalina 或更高版本, 支持 Intel 和 Apple Silicon)。

* 硬件:

 标准的 PC 或 Mac 硬件，对资源占用要求低。

* 软件依赖:

 尽量减少依赖，理想情况下无需安装额外运行时 (除 OS 自带)。

* 2.5 设计与实现约束 (Design and Implementation Constraints):
* 隐私第一:

 严禁记录任何按键的具体字符内容。所有统计数据默认且强制在本地存储。提供清晰的隐私声明。

* 技术选型:

 优先考虑 Tauri (Rust + Web Frontend) 以平衡性能、跨平台和原生交互能力。若 Tauri PoC 遇阻，则备选 Electron 或其他方案，但需解决 Native Module/FFI 的可靠性问题。选择的技术必须能可靠实现跨平台的全局键盘钩子。

* 性能:

 后台监控进程必须轻量化，对系统 CPU 和内存占用影响极小。UI 响应应流畅。

* 跨平台:

 核心功能和 UI 需在 Windows 和 macOS 上表现一致。

* 开源:

 代码将根据选定的开源许可证（如 MIT 或 Apache 2.0）发布。代码结构应清晰，易于理解和贡献。

* 离线核心:

 所有核心统计、分析和可视化功能必须能在无网络连接的情况下运行。

* 2.6 假设与依赖 (Assumptions and Dependencies):
* 假设用户拥有在其操作系统上安装应用程序和允许后台监控（可能需要特定权限设置）的权限。
* 项目成功依赖于能够找到或实现一个稳定、可靠、低延迟、低资源占用的跨平台全局键盘钩子方案。
* 假设用户理解该工具仅用于个人数据分析，而非精确的医学诊断。

3. 具体需求 (Specific Requirements)

* 3.1 功能性需求 (Functional Requirements):
* FR1: 全局键盘事件捕获
* FR1.1: 程序必须能在后台运行时，捕获发生在操作系统全局范围内的键盘按下事件。
* FR1.2: 捕获的事件

仅包含按键标识（如 KeyCode 或 KeySym，区分左右修饰键）、时间戳、事件类型（按下/释放，仅需按下即可）。严禁记录实际字符。

* FR1.3: 程序应能识别当前处于前台的应用程序进程名称或窗口标题，并将按键事件与之关联。
* FR1.4: 对特殊按键（如 Shift, Ctrl, Alt, Win/Cmd, 功能键 F1-F12, 方向键, Enter, Backspace, Esc 等）进行区分统计。
* FR2: 数据本地存储
* FR2.1: 所有捕获的按键事件数据及统计结果必须存储在用户本地计算机的文件中（例如 SQLite 数据库或 JSON 文件）。
* FR2.2: 用户应能方便地找到数据存储位置（如通过应用内设置或文档说明）。
* FR2.3: 存储格式应相对开放，便于用户理解或进行手动处理/备份。
* FR3: 按键计数统计
* FR3.1: 实时更新并显示总按键次数。
* FR3.2: 按时间范围（今日、本周、本月、总计）展示按键次数。
* FR3.3: 分类统计不同类型按键（字母、数字、符号、功能键、修饰键等）的数量和占比。
* FR4: 按键频率分析 (KPM)
* FR4.1: 计算并展示实时的/近期的平均 KPM。
* FR4.2: 展示 KPM 随时间变化的趋势图（如按小时、按天）。
* FR5: 常用按键/组合键分析
* FR5.1: 统计并展示最常使用的单个按键 Top N 列表。
* FR5.2: （可选，复杂度较高）识别并统计常用的组合键（如 Ctrl+C, Cmd+S 等）Top N 列表。需要定义“组合键”的识别逻辑（如时间窗口）。
* FR6: 时间分布分析
* FR6.1: 以图表（如热力图或柱状图）展示一天中（24小时）或一周中（7天）的按键活动强度分布。
* FR7: 应用关联统计
* FR7.1: 统计并展示在不同应用程序中花费的时间（基于按键活动）和按键数量 Top N 列表。
* FR8: 数据可视化
* FR8.1: 使用清晰、直观的图表（如柱状图、折线图、饼图、热力图）展示 FR3 至 FR7 的统计结果。
* FR8.2: 图表应支持基本交互，如鼠标悬停显示具体数值 (Tooltip)。
* FR9: 数据导出
* FR9.1: 提供将原始按键数据（时间戳、按键标识、关联应用）或聚合统计数据导出为通用格式（如 CSV 或 JSON）的功能。
* FR9.2: 用户可以选择导出的时间范围或数据类型。
* FR10: 用户控制
* FR10.1: 提供明确的按钮或开关，允许用户随时暂停 (Pause) 和恢复 (Resume) 按键记录。
* FR10.2: 提供停止 (Stop) 记录的功能（例如，直到下次手动启动或应用重启）。
* FR10.3: 提供彻底删除所有已记录历史数据的功能，并需用户确认。
* FR10.4: （可选）提供按时间范围删除数据的功能。
* FR11: 基础健康评估
* FR11.1: 提供一个简单的设置区域，让用户自愿输入职业类型、平均每日电脑使用时长等信息（非强制）。
* FR11.2: 基于用户的输入信息和记录的按键强度（如 KPM、连续打字时间），通过预设的简单规则算法，生成简短的、提示性的健康风险文字说明（例如，“长时间高强度输入，请注意定时休息”）。
* FR11.3:

必须明确声明此评估不是医疗建议，仅为基于有限数据的提示。

* FR12: AI 分析引导
* FR12.1: 在 UI 中提供一个明确标记的按钮或链接，例如“使用 AI 获取深度分析报告”。
* FR12.2: 点击该按钮后，

不执行任何本地 AI 计算，而是弹出说明窗口或跳转到应用内的一个静态页面。

* FR12.3: 该说明页面将指导用户如何使用 FR9 的导出功能导出数据，并提供一个

外部网站的链接（未来开发者可能建立的独立服务）。

* FR12.4: 说明需强调数据导出和上传至外部网站是用户自愿行为，并提示用户查看外部网站的隐私政策。
* FR13: 应用设置
* FR13.1: 提供设置项：是否开机自启动。
* FR13.2: （可选）提供基础的界面主题选择（如浅色/深色模式）。
* 3.2 非功能性需求 (Non-Functional Requirements):
* NFR1: 性能 (Performance)
* NFR1.1: 后台监控进程的平均 CPU 使用率应低于 5%。
* NFR1.2: 应用（包括后台和 UI）的稳定内存占用应低于 100MB (具体数值待根据技术选型确定和优化)。
* NFR1.3: 键盘事件捕获延迟应尽可能低，不影响用户正常打字体验。
* NFR1.4: UI 界面响应流畅，图表加载时间在可接受范围内（如秒级）。
* NFR2: 易用性 (Usability)
* NFR2.1: UI 设计简洁直观，用户无需阅读复杂手册即可理解核心功能和数据展示。
* NFR2.2: 安装过程简单。
* NFR2.3: 关键操作（启停记录、删除数据）易于找到且有确认提示。
* NFR3: 可靠性 (Reliability)
* NFR3.1: 应用运行稳定，崩溃率低。
* NFR3.2: 键盘钩子在常见的 OS 更新后应能继续工作（可能需要维护更新）。
* NFR3.3: 数据记录准确，丢数据率低。
* NFR3.4: 能优雅处理错误情况（如无法启动钩子、数据文件损坏），并给出提示。
* NFR4: 安全性 (Security)
* NFR4.1: 确保本地存储的数据文件具有基本的操作系统文件权限保护。
* NFR4.2: 键盘钩子实现应避免引入安全漏洞（如被其他恶意程序利用）。
* NFR4.3:

绝对禁止任何未经用户明确同意的网络数据传输（核心功能）。

* NFR5: 隐私 (Privacy)
* NFR5.1: 在应用首次启动、安装过程或显著位置提供清晰易懂的隐私政策说明，明确告知用户记录什么、不记录什么、数据存储在哪里、用户有哪些控制权。
* NFR5.2: 严格遵守“本地存储优先”原则。
* NFR5.3: 用户拥有对其数据的完全控制权（查看、导出、删除）。
* NFR6: 可维护性 (Maintainability) (针对开源)
* NFR6.1: 代码结构清晰、模块化。
* NFR6.2: 提供必要的代码注释，特别是复杂逻辑或原生交互部分。
* NFR6.3: 提供简洁的构建说明和贡献指南。
* NFR6.4: 遵循所选语言和框架的编码规范。
* NFR7: 可移植性 (Portability)
* NFR7.1: 应用程序应能在受支持的 Windows 和 macOS 版本上无需修改代码即可编译和运行（允许平台特定的编译配置）。
* NFR7.2: 用户体验在不同平台上应保持一致性。
* 3.3 界面需求 (Interface Requirements):
* IFR1: 用户界面 (User Interface)
* IFR1.1: 提供图形用户界面 (GUI)。
* IFR1.2: 界面布局清晰，分为数据展示区、控制区、设置区等。
* IFR1.3: 图表美观、易于解读。
* IFR1.4: （可选）支持窗口大小调整和内容自适应。
* IFR2: 操作系统接口 (Operating System Interfaces)
* IFR2.1: 通过 OS API 实现全局键盘事件监听。
* IFR2.2: 通过 OS API 获取当前活动应用程序信息。
* IFR2.3: （可选）通过 OS API 实现开机自启动功能。
* IFR2.4: （可选）通过 OS API 与系统托盘/菜单栏集成，提供快捷访问和状态显示。

4. 未来考虑 / 超出范围 (Future Considerations / Out of Scope for v1.0)

* 鼠标活动统计（点击次数、移动距离、滚轮滚动）。
* 更复杂的健康模型或 RSI 风险预测。
* 与其他应用（如日历、任务管理）集成。
* 可选的、端到端加密的云同步功能。
* 目标设定与提醒功能（如每日按键上限、休息提醒）。
* 多语言支持。
* 高级数据过滤和对比分析功能。
* 插件系统以支持社区扩展。
